syntax = "proto3";

package serveralpha.user;

import "common/common.proto";

option go_package = "github.com/wwi21seb-projekt/alpha-shared/proto/user;serveralpha";

// GUIDELINES
// https://cloud.google.com/apis/design/standard_methods
// https://cloud.google.com/apis/design/custom_methods
// https://cloud.google.com/apis/design/naming_convention#method_names
// "The method names should follow the naming convention of VerbNoun in upper camel case, where the noun is typically the resource type."

// ------------------ Services ------------------ //


service AuthenticationService{ // https://cloud.google.com/apis/design/naming_convention#interface_names
  rpc RegisterUser(RegisterUserRequest) returns (User);
  rpc ResendActivationEmail(ResendActivationEmailRequest) returns (common.Empty);
  rpc ActivateUser(ActivateUserRequest) returns (common.Empty);
  rpc LoginUser(LoginUserRequest) returns (common.Empty);
  rpc UpdatePassword(ChangePasswordRequest) returns (common.Empty);
  rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);
}

service UserService{
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);
  rpc SearchUsers(SearchUsersRequest) returns (SearchUsersResponse);
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
}

service SubscriptionService{
  rpc ListSubscriptions(ListSubscriptionsRequest) returns (ListSubscriptionsResponse);
  rpc CreateSubscription(CreateSubscriptionRequest) returns (CreateSubscriptionResponse);
  rpc DeleteSubscription(DeleteSubscriptionRequest) returns (common.Empty);
}

// ------------------ Enums ------------------ //

enum SubscriptionType{
  SUBSCRIPTION_TYPE_FOLLOWER = 0; // default by setting to 0
  SUBSCRIPTION_TYPE_FOLLOWING = 1;
}

// ------------------ Messages ------------------ //

message User{
  string username = 1;
  string nickname = 2;
  string email = 3;
  string profile_picture_url = 4;
}

message UsernameResponse{
  string username = 1;
}

message GetUserResponse{
  string username = 1;
  string nickname = 2;
  string status = 3;
  string profile_picture_url = 4;
  int32 follower_count = 5;
  int32 following_count = 6;
  int32 post_count = 7;
  string subscription_id = 8; // if present, the current user is following the requested user
}

message UpdateUserResponse {
  string nickname = 1;
  string status = 2;
}

message SearchUsersResponse{
  repeated User users = 1;
  common.Pagination pagination = 2;
}

message ListUsersResponse{
  repeated User users = 1;
}

message CreateSubscriptionResponse{
  string subscription_id = 1;
  string subscription_date = 2;
  string follower_username = 3;
  string followed_username = 4;
}

message Subscription{
  string follower_subscription_id = 1; // populated when the other user follows the current user
  string followed_subscription_id = 2; // populated when the current user follows the other user
  string username = 3; // the username of the other user
  string nickname = 4; // the nickname of the other user
  string profile_picture_url = 5; // the profile picture of the other user
}

message ListSubscriptionsResponse{
  repeated Subscription subscriptions = 1;
  common.Pagination pagination = 2;
}

message ResetPasswordResponse{
  string email = 1;
}

// ------------------ Requests ------------------ //

message ListUsersRequest{
    repeated string usernames = 1;
}

message RegisterUserRequest{
  string username = 1;
  string password = 2;
  string nickname = 3;
  string email = 4;
}

message ResendActivationEmailRequest{
  string username = 1;
}

message ActivateUserRequest{
  string token = 1;
  string username = 2;
}

message LoginUserRequest{
  string username = 1;
  string password = 2;
}

message GetUserRequest{
  string username = 1;
}

message SearchUsersRequest{
  common.PaginationRequest pagination = 1;
  string query = 2;
}

message UpdateUserRequest{
  string nickname = 1;
  string status = 2;
}

message ChangePasswordRequest{
  string old_password = 1;
  string new_password = 2;
}

message ListSubscriptionsRequest{
  common.PaginationRequest pagination = 1;
  SubscriptionType subscription_type = 2;
  string username = 3;
}

message CreateSubscriptionRequest{
  string followed_username = 1;
}

message DeleteSubscriptionRequest{
  string subscription_id = 1;
}

message ResetPasswordRequest{
  string username = 1;
}

message SetPasswordRequest{
  string username = 1;
  string new_password = 2;
  string token = 3;
}